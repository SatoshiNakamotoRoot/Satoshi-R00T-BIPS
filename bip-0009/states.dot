digraph {
  rankdir=TD;

  node [style="rounded,filled,bold", shape=box, fixedsize=true, width=1.5, fontname="Arial"];

  edge [weight = 100];
  "DEFINED" -> "STARTED" [label="MTP >= starttime"];
  "STARTED" -> "FAILED" [label="count < threshold\nMTP >= timeout"];
  "LOCKED_IN" -> "LOCKED_IN" [label="height + 1 < min_activation_height"];
  "LOCKED_IN" -> "ACTIVE" [label="height + 1 >= min_activation_height"];

  edge [weight = 1];
  "STARTED" -> "LOCKED_IN" [label="count >= threshold"];

  "FAILED" -> "LOCKED_IN" [style=invis];

  "DEFINED"-> "DEFINED" [label="MTP < starttime"];
  "STARTED"-> "STARTED" [label="count < threshold\nMTP < timeout"];
  "ACTIVE" -> "ACTIVE";
  "FAILED" -> "FAILED";

  "STARTED" [fillcolor="#a0a0ff"];
  "LOCKED_IN" [fillcolor="#ffffa0"];
  "ACTIVE" [fillcolor="#a0ffa0"];
  "FAILED" [fillcolor="#ffa0a0"];

  { rank=same; "FAILED" "LOCKED_IN" }
  { rank=sink; "ACTIVE" }
}
